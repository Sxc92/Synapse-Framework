# Synapse Events æ¨¡å—

## ğŸ“– æ¨¡å—æ¦‚è¿°

Synapse Events æ˜¯ Synapse Framework çš„äº‹ä»¶é©±åŠ¨æ¨¡å—ï¼Œæä¾›äº†å®Œæ•´çš„äº‹ä»¶å‘å¸ƒã€è®¢é˜…å’Œå¤„ç†æœºåˆ¶ã€‚è¯¥æ¨¡å—åŸºäº Spring çš„äº‹ä»¶ç³»ç»Ÿï¼Œæ‰©å±•äº†åˆ†å¸ƒå¼äº‹ä»¶ã€äº‹åŠ¡äº‹ä»¶ã€å¼‚æ­¥äº‹ä»¶ç­‰é«˜çº§åŠŸèƒ½ï¼Œä¸ºåº”ç”¨æä¾›æ¾è€¦åˆã€é«˜å¯æ‰©å±•æ€§çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. äº‹ä»¶å‘å¸ƒè®¢é˜…
- **æœ¬åœ°äº‹ä»¶**ï¼šåº”ç”¨å†…çš„äº‹ä»¶å‘å¸ƒå’Œè®¢é˜…
- **åˆ†å¸ƒå¼äº‹ä»¶**ï¼šè·¨åº”ç”¨ã€è·¨æœåŠ¡çš„äº‹ä»¶ä¼ æ’­
- **äº‹ä»¶è·¯ç”±**ï¼šæ™ºèƒ½çš„äº‹ä»¶è·¯ç”±å’Œåˆ†å‘æœºåˆ¶
- **äº‹ä»¶è¿‡æ»¤**ï¼šåŸºäºæ¡ä»¶çš„äº‹ä»¶è¿‡æ»¤å’Œé€‰æ‹©

### 2. äº‹åŠ¡äº‹ä»¶ç®¡ç†
- **äº‹åŠ¡ç»‘å®š**ï¼šäº‹ä»¶ä¸äº‹åŠ¡çš„ç»‘å®šå…³ç³»
- **äº‹åŠ¡å›æ»š**ï¼šäº‹åŠ¡å›æ»šæ—¶çš„äº‹ä»¶å¤„ç†
- **äº‹åŠ¡ä¼ æ’­**ï¼šè·¨äº‹åŠ¡è¾¹ç•Œçš„äº‹ä»¶ä¼ æ’­
- **äº‹åŠ¡ç›‘æ§**ï¼šäº‹åŠ¡äº‹ä»¶çš„ç›‘æ§å’Œç»Ÿè®¡

### 3. å¼‚æ­¥äº‹ä»¶å¤„ç†
- **å¼‚æ­¥æ‰§è¡Œ**ï¼šäº‹ä»¶çš„å¼‚æ­¥å¤„ç†å’Œæ‰§è¡Œ
- **çº¿ç¨‹æ± ç®¡ç†**ï¼šå¯é…ç½®çš„çº¿ç¨‹æ± ç­–ç•¥
- **é‡è¯•æœºåˆ¶**ï¼šäº‹ä»¶å¤„ç†å¤±è´¥çš„é‡è¯•ç­–ç•¥
- **è¶…æ—¶æ§åˆ¶**ï¼šäº‹ä»¶å¤„ç†çš„è¶…æ—¶æ§åˆ¶

### 4. äº‹ä»¶æŒä¹…åŒ–
- **äº‹ä»¶å­˜å‚¨**ï¼šäº‹ä»¶çš„æŒä¹…åŒ–å­˜å‚¨
- **äº‹ä»¶é‡æ”¾**ï¼šå†å²äº‹ä»¶çš„é‡æ–°æ’­æ”¾
- **äº‹ä»¶å®¡è®¡**ï¼šäº‹ä»¶æ“ä½œçš„å®¡è®¡æ—¥å¿—
- **äº‹ä»¶æ¸…ç†**ï¼šè¿‡æœŸäº‹ä»¶çš„è‡ªåŠ¨æ¸…ç†

### 5. äº‹ä»¶ç›‘æ§å’Œç»Ÿè®¡
- **æ€§èƒ½ç›‘æ§**ï¼šäº‹ä»¶å¤„ç†çš„æ€§èƒ½æŒ‡æ ‡
- **é”™è¯¯ç»Ÿè®¡**ï¼šäº‹ä»¶å¤„ç†é”™è¯¯çš„ç»Ÿè®¡
- **å»¶è¿Ÿåˆ†æ**ï¼šäº‹ä»¶å¤„ç†å»¶è¿Ÿçš„åˆ†æ
- **ååé‡ç›‘æ§**ï¼šäº‹ä»¶å¤„ç†ååé‡çš„ç›‘æ§

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å—ç»“æ„
```
synapse-events/
â”œâ”€â”€ annotation/      # äº‹ä»¶æ³¨è§£
â”œâ”€â”€ config/          # é…ç½®ç®¡ç†
â”œâ”€â”€ core/            # æ ¸å¿ƒåŠŸèƒ½
â”œâ”€â”€ transaction/     # äº‹åŠ¡äº‹ä»¶
â””â”€â”€ utils/           # å·¥å…·ç±»
```

### æ ¸å¿ƒç»„ä»¶
- **EventPublisher**ï¼šäº‹ä»¶å‘å¸ƒå™¨
- **EventSubscriber**ï¼šäº‹ä»¶è®¢é˜…å™¨
- **EventDispatcher**ï¼šäº‹ä»¶åˆ†å‘å™¨
- **EventStore**ï¼šäº‹ä»¶å­˜å‚¨
- **EventMonitor**ï¼šäº‹ä»¶ç›‘æ§å™¨

### äº‹ä»¶æµç¨‹
```
äº‹ä»¶å‘å¸ƒ â†’ äº‹ä»¶è·¯ç”± â†’ äº‹ä»¶åˆ†å‘ â†’ äº‹ä»¶å¤„ç† â†’ ç»“æœå›è°ƒ
    â†“           â†“         â†“         â†“         â†“
  å‘å¸ƒå™¨    è·¯ç”±ç­–ç•¥   åˆ†å‘ç­–ç•¥   å¤„ç†å™¨    å›è°ƒå¤„ç†
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.indigo</groupId>
    <artifactId>synapse-events</artifactId>
    <version>${synapse.version}</version>
</dependency>
```

### 2. åŸºç¡€é…ç½®

```yaml
# application.yml
synapse:
  events:
    # äº‹ä»¶é…ç½®
    enabled: true
    
    # å¼‚æ­¥å¤„ç†é…ç½®
    async:
      enabled: true
      core-pool-size: 5
      max-pool-size: 20
      queue-capacity: 100
      keep-alive-seconds: 60
    
    # åˆ†å¸ƒå¼äº‹ä»¶é…ç½®
    distributed:
      enabled: false
      broker-url: tcp://localhost:61616
      topic-prefix: synapse.events
    
    # äº‹ä»¶å­˜å‚¨é…ç½®
    storage:
      enabled: true
      type: memory  # memory, redis, database
      retention-days: 30
```

### 3. ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€äº‹ä»¶å‘å¸ƒè®¢é˜…
```java
// å®šä¹‰äº‹ä»¶
public class UserCreatedEvent extends BaseEvent {
    private Long userId;
    private String username;
    
    public UserCreatedEvent(Long userId, String username) {
        this.userId = userId;
        this.username = username;
    }
    
    // getters and setters
}

// å‘å¸ƒäº‹ä»¶
@Service
public class UserService {
    
    @Autowired
    private EventPublisher eventPublisher;
    
    public void createUser(User user) {
        // åˆ›å»ºç”¨æˆ·
        userRepository.save(user);
        
        // å‘å¸ƒç”¨æˆ·åˆ›å»ºäº‹ä»¶
        UserCreatedEvent event = new UserCreatedEvent(user.getId(), user.getUsername());
        eventPublisher.publish(event);
    }
}

// è®¢é˜…äº‹ä»¶
@Component
public class UserEventHandler {
    
    @EventListener
    public void handleUserCreated(UserCreatedEvent event) {
        log.info("ç”¨æˆ·åˆ›å»ºäº‹ä»¶: userId={}, username={}", 
                event.getUserId(), event.getUsername());
        
        // å¤„ç†ç”¨æˆ·åˆ›å»ºåçš„ä¸šåŠ¡é€»è¾‘
        sendWelcomeEmail(event.getUserId());
        createUserProfile(event.getUserId());
    }
}
```

#### å¼‚æ­¥äº‹ä»¶å¤„ç†
```java
@Component
public class AsyncEventHandler {
    
    @AsyncEventListener
    public void handleAsyncEvent(AsyncEvent event) {
        // å¼‚æ­¥å¤„ç†äº‹ä»¶
        log.info("å¼‚æ­¥å¤„ç†äº‹ä»¶: {}", event.getEventType());
        
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        log.info("å¼‚æ­¥äº‹ä»¶å¤„ç†å®Œæˆ: {}", event.getEventType());
    }
}
```

#### äº‹åŠ¡äº‹ä»¶
```java
@Service
@Transactional
public class OrderService {
    
    @Autowired
    private EventPublisher eventPublisher;
    
    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•
        orderRepository.save(order);
        
        // å‘å¸ƒäº‹åŠ¡äº‹ä»¶ï¼ˆäº‹åŠ¡æäº¤åæ‰ä¼šå‘å¸ƒï¼‰
        OrderCreatedEvent event = new OrderCreatedEvent(order.getId());
        eventPublisher.publishAfterCommit(event);
        
        // å‘å¸ƒäº‹åŠ¡äº‹ä»¶ï¼ˆäº‹åŠ¡æäº¤å‰å‘å¸ƒï¼‰
        OrderProcessingEvent processingEvent = new OrderProcessingEvent(order.getId());
        eventPublisher.publishBeforeCommit(processingEvent);
    }
}
```

#### æ¡ä»¶äº‹ä»¶è®¢é˜…
```java
@Component
public class ConditionalEventHandler {
    
    @EventListener(condition = "#event.amount > 1000")
    public void handleLargeOrder(OrderCreatedEvent event) {
        log.info("å¤„ç†å¤§é¢è®¢å•: orderId={}, amount={}", 
                event.getOrderId(), event.getAmount());
        
        // å¤§é¢è®¢å•çš„ç‰¹æ®Šå¤„ç†é€»è¾‘
        notifyManager(event.getOrderId());
        applyRiskCheck(event.getOrderId());
    }
    
    @EventListener(condition = "#event.userType == 'VIP'")
    public void handleVipUser(UserCreatedEvent event) {
        log.info("å¤„ç†VIPç”¨æˆ·: userId={}", event.getUserId());
        
        // VIPç”¨æˆ·çš„ç‰¹æ®Šå¤„ç†
        assignVipBenefits(event.getUserId());
    }
}
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰äº‹ä»¶åˆ†å‘å™¨
```java
@Component
public class CustomEventDispatcher implements EventDispatcher {
    
    @Override
    public void dispatch(Event event, List<EventListener> listeners) {
        // è‡ªå®šä¹‰äº‹ä»¶åˆ†å‘é€»è¾‘
        for (EventListener listener : listeners) {
            if (canHandle(listener, event)) {
                try {
                    listener.onEvent(event);
                } catch (Exception e) {
                    handleDispatchError(event, listener, e);
                }
            }
        }
    }
    
    private boolean canHandle(EventListener listener, Event event) {
        // è‡ªå®šä¹‰å¤„ç†æ¡ä»¶åˆ¤æ–­
        return listener.getEventType().isAssignableFrom(event.getClass());
    }
}
```

### 2. äº‹ä»¶é‡è¯•æœºåˆ¶
```java
@Component
public class RetryableEventHandler {
    
    @EventListener
    @Retryable(maxAttempts = 3, backoff = @Backoff(delay = 1000))
    public void handleWithRetry(RetryableEvent event) {
        log.info("å¤„ç†å¯é‡è¯•äº‹ä»¶: {}", event.getEventType());
        
        // å¯èƒ½å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘
        processEvent(event);
    }
    
    @Recover
    public void recover(RetryableEvent event, Exception e) {
        log.error("äº‹ä»¶å¤„ç†æœ€ç»ˆå¤±è´¥: {}", event.getEventType(), e);
        
        // å¤±è´¥åçš„æ¢å¤å¤„ç†
        sendFailureNotification(event);
        storeFailedEvent(event);
    }
}
```

### 3. äº‹ä»¶ç›‘æ§å’Œç»Ÿè®¡
```java
@Component
public class EventMonitor {
    
    @EventListener
    public void monitorEvent(Event event) {
        // è®°å½•äº‹ä»¶ç»Ÿè®¡ä¿¡æ¯
        EventStatistics stats = EventStatistics.getInstance();
        stats.recordEvent(event.getClass().getSimpleName());
        
        // è®°å½•äº‹ä»¶å¤„ç†æ—¶é—´
        long startTime = System.currentTimeMillis();
        
        // äº‹ä»¶å¤„ç†å®Œæˆåè®°å½•è€—æ—¶
        stats.recordProcessingTime(event.getClass().getSimpleName(), 
                System.currentTimeMillis() - startTime);
    }
}
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### 1. äº‹ä»¶ç¼“å­˜
- **äº‹ä»¶ç¼“å­˜**ï¼šå¸¸ç”¨äº‹ä»¶çš„ç¼“å­˜æœºåˆ¶
- **è®¢é˜…è€…ç¼“å­˜**ï¼šäº‹ä»¶è®¢é˜…è€…çš„ç¼“å­˜
- **è·¯ç”±ç¼“å­˜**ï¼šäº‹ä»¶è·¯ç”±è§„åˆ™çš„ç¼“å­˜

### 2. å¼‚æ­¥ä¼˜åŒ–
- **çº¿ç¨‹æ± ä¼˜åŒ–**ï¼šå¯é…ç½®çš„çº¿ç¨‹æ± ç­–ç•¥
- **æ‰¹é‡å¤„ç†**ï¼šäº‹ä»¶çš„æ‰¹é‡å¤„ç†æœºåˆ¶
- **ä¼˜å…ˆçº§é˜Ÿåˆ—**ï¼šåŸºäºä¼˜å…ˆçº§çš„äº‹ä»¶é˜Ÿåˆ—

### 3. å†…å­˜ä¼˜åŒ–
- **äº‹ä»¶æ± åŒ–**ï¼šäº‹ä»¶å¯¹è±¡çš„å¯¹è±¡æ± 
- **å†…å­˜ç›‘æ§**ï¼šäº‹ä»¶å¤„ç†çš„å†…å­˜ç›‘æ§
- **åƒåœ¾å›æ”¶**ï¼šè‡ªåŠ¨çš„å†…å­˜æ¸…ç†æœºåˆ¶

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. äº‹ä»¶å®‰å…¨
- **æƒé™éªŒè¯**ï¼šäº‹ä»¶å‘å¸ƒçš„æƒé™æ§åˆ¶
- **æ•°æ®è„±æ•**ï¼šæ•æ„Ÿäº‹ä»¶çš„è‡ªåŠ¨è„±æ•
- **è®¿é—®æ§åˆ¶**ï¼šäº‹ä»¶è®¢é˜…çš„è®¿é—®æ§åˆ¶

### 2. å®¡è®¡æ—¥å¿—
- **æ“ä½œå®¡è®¡**ï¼šäº‹ä»¶æ“ä½œçš„å®Œæ•´å®¡è®¡
- **å˜æ›´è¿½è¸ª**ï¼šäº‹ä»¶æ•°æ®çš„å˜æ›´è¿½è¸ª
- **åˆè§„æ£€æŸ¥**ï¼šäº‹ä»¶å¤„ç†çš„åˆè§„æ€§æ£€æŸ¥

## ğŸ“ æœ€ä½³å®è·µ

### 1. äº‹ä»¶è®¾è®¡
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½åçº¦å®š
- ä¿æŒäº‹ä»¶çš„ä¸å¯å˜æ€§
- åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- é¿å…åœ¨äº‹ä»¶ä¸­åŒ…å«æ•æ„Ÿæ•°æ®

### 2. äº‹ä»¶å¤„ç†
- ä¿æŒäº‹ä»¶å¤„ç†å™¨çš„è½»é‡çº§
- ä½¿ç”¨å¼‚æ­¥å¤„ç†å¤„ç†è€—æ—¶æ“ä½œ
- å®ç°å¹‚ç­‰æ€§çš„äº‹ä»¶å¤„ç†
- æä¾›é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶

### 3. æ€§èƒ½ä¼˜åŒ–
- åˆç†é…ç½®çº¿ç¨‹æ± å‚æ•°
- ä½¿ç”¨äº‹ä»¶è¿‡æ»¤å‡å°‘ä¸å¿…è¦çš„å¤„ç†
- ç›‘æ§äº‹ä»¶å¤„ç†çš„æ€§èƒ½æŒ‡æ ‡
- å®šæœŸæ¸…ç†è¿‡æœŸçš„äº‹ä»¶æ•°æ®

### 4. ç›‘æ§å’Œè°ƒè¯•
- å®ç°å®Œæ•´çš„äº‹ä»¶ç›‘æ§
- è®°å½•è¯¦ç»†çš„äº‹ä»¶å¤„ç†æ—¥å¿—
- æä¾›äº‹ä»¶å¤„ç†çš„æ€§èƒ½åˆ†æ
- å®ç°äº‹ä»¶å¤„ç†çš„å¥åº·æ£€æŸ¥

## ğŸ› å¸¸è§é—®é¢˜

### 1. äº‹ä»¶ä¸¢å¤±
**é—®é¢˜**ï¼šæŸäº›äº‹ä»¶æ²¡æœ‰è¢«å¤„ç†æˆ–ä¸¢å¤±
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥äº‹ä»¶è®¢é˜…è€…çš„æ³¨å†Œ
- éªŒè¯äº‹ä»¶ç±»å‹åŒ¹é…
- æ£€æŸ¥äº‹ä»¶è¿‡æ»¤æ¡ä»¶
- ç¡®è®¤äº‹ä»¶å‘å¸ƒæ—¶æœº

### 2. äº‹ä»¶å¤„ç†è¶…æ—¶
**é—®é¢˜**ï¼šäº‹ä»¶å¤„ç†æ—¶é—´è¿‡é•¿å¯¼è‡´è¶…æ—¶
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨å¼‚æ­¥äº‹ä»¶å¤„ç†
- ä¼˜åŒ–äº‹ä»¶å¤„ç†é€»è¾‘
- è°ƒæ•´çº¿ç¨‹æ± é…ç½®
- å®ç°è¶…æ—¶æ§åˆ¶æœºåˆ¶

### 3. å†…å­˜æ³„æ¼
**é—®é¢˜**ï¼šäº‹ä»¶å¤„ç†å¯¼è‡´å†…å­˜ä½¿ç”¨æŒç»­å¢é•¿
**è§£å†³æ–¹æ¡ˆ**ï¼š
- åŠæ—¶æ¸…ç†äº‹ä»¶æ•°æ®
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®ç°äº‹ä»¶æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å®šæœŸè¿›è¡Œåƒåœ¾å›æ”¶

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Synapse Framework æ¶æ„è®¾è®¡](../../ARCHITECTURE.md)
- [Synapse Framework ä½¿ç”¨æŒ‡å—](../../USAGE_GUIDE.md)
- [Synapse Framework æ¶æ„è®¾è®¡](../../ARCHITECTURE.md)

## ğŸ”— ç›¸å…³é“¾æ¥

- [Spring äº‹ä»¶æœºåˆ¶](https://spring.io/projects/spring-framework)
- [äº‹ä»¶é©±åŠ¨æ¶æ„](https://martinfowler.com/articles/201701-event-driven.html)
- [å¼‚æ­¥äº‹ä»¶å¤„ç†](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-events)

---

*æœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´08æœˆ11æ—¥ 12:41:56* 