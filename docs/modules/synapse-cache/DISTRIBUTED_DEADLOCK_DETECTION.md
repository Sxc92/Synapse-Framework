# åˆ†å¸ƒå¼æ­»é”æ£€æµ‹åŠŸèƒ½è¯¦è§£

## æ¦‚è¿°

åˆ†å¸ƒå¼æ­»é”æ£€æµ‹æ˜¯ Synapse Cache æ¨¡å—çš„é«˜çº§åŠŸèƒ½ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­æ£€æµ‹å’Œå¤„ç†è·¨èŠ‚ç‚¹çš„æ­»é”æƒ…å†µã€‚è¯¥åŠŸèƒ½åŸºäº Redis æ„å»ºå…¨å±€èµ„æºåˆ†é…å›¾ï¼Œå®ç°æ··åˆæ£€æµ‹ç­–ç•¥å’Œæ™ºèƒ½åè°ƒå¤„ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” **æ··åˆæ£€æµ‹ç­–ç•¥**
- **æœ¬åœ°æ£€æµ‹**: å¿«é€Ÿæ£€æµ‹å•èŠ‚ç‚¹å†…çš„æ­»é”
- **å…¨å±€æ£€æµ‹**: è·¨èŠ‚ç‚¹æ£€æµ‹åˆ†å¸ƒå¼æ­»é”
- **æ™ºèƒ½åè°ƒ**: æœ¬åœ°æ­»é”ç«‹å³å¤„ç†ï¼Œå…¨å±€æ­»é”åè°ƒå¤„ç†

### ğŸ”„ **çŠ¶æ€åŒæ­¥æœºåˆ¶**
- **å®šæœŸåŒæ­¥**: å°†æœ¬åœ°é”çŠ¶æ€åŒæ­¥åˆ° Redis å…¨å±€å›¾
- **å®æ—¶æ›´æ–°**: é”è·å–å’Œé‡Šæ”¾æ—¶å®æ—¶æ›´æ–°çŠ¶æ€
- **å¢é‡åŒæ­¥**: åªåŒæ­¥å˜åŒ–çš„çŠ¶æ€ï¼Œå‡å°‘ç½‘ç»œå¼€é”€

### ğŸŒ **åˆ†å¸ƒå¼ç®—æ³•**
- **DFSç¯æ£€æµ‹**: ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æ£€æµ‹æ­»é”ç¯
- **èŠ‚ç‚¹åè°ƒ**: é€šè¿‡å¿ƒè·³æœºåˆ¶ç®¡ç†åˆ†å¸ƒå¼èŠ‚ç‚¹
- **å®¹é”™å¤„ç†**: å•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“æ£€æµ‹

### âš¡ **æ™ºèƒ½å¤„ç†**
- **ç‰ºç‰²é€‰æ‹©**: æ™ºèƒ½é€‰æ‹©ç‰ºç‰²çº¿ç¨‹æ‰“ç ´æ­»é”
- **è‡ªåŠ¨æ¢å¤**: è‡ªåŠ¨é‡Šæ”¾é”å¹¶é€šçŸ¥ç›¸å…³èŠ‚ç‚¹
- **çŠ¶æ€æ¸…ç†**: å®šæœŸæ¸…ç†è¶…æ—¶èŠ‚ç‚¹çŠ¶æ€

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DistributedDeadlockDetector              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Local State   â”‚  â”‚  Global State   â”‚  â”‚ Coordination â”‚ â”‚
â”‚  â”‚   Management    â”‚  â”‚   Management    â”‚  â”‚   Manager    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Sync Engine   â”‚  â”‚ Detection Algo  â”‚  â”‚ Recovery     â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚ Engine       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Redis Storage                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Graph     â”‚ â”‚   Waits     â”‚ â”‚  Holders    â”‚ â”‚ Nodes   â”‚ â”‚
â”‚  â”‚   Data      â”‚ â”‚   Data      â”‚ â”‚   Data      â”‚ â”‚ Status  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

1. **çŠ¶æ€æ”¶é›†**: æ”¶é›†æœ¬åœ°çº¿ç¨‹é”ä¿¡æ¯ã€ç­‰å¾…å…³ç³»å’Œé”æŒæœ‰è€…
2. **çŠ¶æ€åŒæ­¥**: å°†æœ¬åœ°çŠ¶æ€åŒæ­¥åˆ° Redis å…¨å±€å­˜å‚¨
3. **ç¯æ£€æµ‹**: åœ¨å…¨å±€å›¾ä¸­ä½¿ç”¨ DFS ç®—æ³•æ£€æµ‹æ­»é”ç¯
4. **åè°ƒå¤„ç†**: é€‰æ‹©ç‰ºç‰²çº¿ç¨‹å¹¶é€šçŸ¥ç›¸å…³èŠ‚ç‚¹
5. **çŠ¶æ€æ¸…ç†**: æ¸…ç†è¶…æ—¶èŠ‚ç‚¹å’Œæ— æ•ˆçŠ¶æ€

## é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®

```yaml
synapse:
  cache:
    lock:
      deadlock:
        distributed:
          # æ˜¯å¦å¯ç”¨åˆ†å¸ƒå¼æ­»é”æ£€æµ‹
          enabled: true
          # çŠ¶æ€åŒæ­¥é—´éš”(æ¯«ç§’)
          sync-interval: 5000
          # å…¨å±€æ£€æµ‹é—´éš”(æ¯«ç§’)
          global-detection-interval: 10000
          # èŠ‚ç‚¹è¶…æ—¶æ—¶é—´(æ¯«ç§’)
          node-timeout: 30000
          # æœ€å¤§èŠ‚ç‚¹æ•°é‡
          max-nodes: 10
          # Redisé”®å‰ç¼€
          redis-prefix: "deadlock:global"
          # æ˜¯å¦å¯ç”¨è°ƒè¯•æ—¥å¿—
          debug: false
          # å¿ƒè·³é—´éš”(æ¯«ç§’)
          heartbeat-interval: 1000
          # æ¸…ç†é—´éš”(æ¯«ç§’)
          cleanup-interval: 30000
```

### é…ç½®å‚æ•°è¯¦è§£

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `enabled` | `true` | æ˜¯å¦å¯ç”¨åˆ†å¸ƒå¼æ­»é”æ£€æµ‹ |
| `sync-interval` | `5000` | æœ¬åœ°çŠ¶æ€åŒæ­¥åˆ°Redisçš„é—´éš” |
| `global-detection-interval` | `10000` | å…¨å±€æ­»é”æ£€æµ‹çš„æ‰§è¡Œé—´éš” |
| `node-timeout` | `30000` | èŠ‚ç‚¹è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡æ­¤æ—¶é—´è®¤ä¸ºèŠ‚ç‚¹å¤±æ•ˆ |
| `max-nodes` | `10` | æœ€å¤§æ”¯æŒçš„èŠ‚ç‚¹æ•°é‡ |
| `redis-prefix` | `"deadlock:global"` | Redisä¸­å­˜å‚¨å…¨å±€çŠ¶æ€çš„é”®å‰ç¼€ |
| `debug` | `false` | æ˜¯å¦å¯ç”¨è°ƒè¯•æ—¥å¿— |
| `heartbeat-interval` | `1000` | èŠ‚ç‚¹å¿ƒè·³æ›´æ–°é—´éš” |
| `cleanup-interval` | `30000` | è¶…æ—¶èŠ‚ç‚¹æ¸…ç†é—´éš” |

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```java
@Service
public class DeadlockDetectionService {
    
    @Autowired
    private LockManager lockManager;
    
    /**
     * è·å–åˆ†å¸ƒå¼æ­»é”æ£€æµ‹çŠ¶æ€
     */
    public Map<String, Object> getDeadlockStatus() {
        return lockManager.getDistributedDeadlockStatus();
    }
    
    /**
     * æ‰‹åŠ¨è§¦å‘å…¨å±€æ­»é”æ£€æµ‹
     */
    public List<Set<String>> detectDeadlocks() {
        return lockManager.detectGlobalDeadlocks();
    }
    
    /**
     * åŒæ­¥æœ¬åœ°çŠ¶æ€åˆ°å…¨å±€
     */
    public void syncLocalState() {
        lockManager.syncLocalStateToGlobal();
    }
    
    /**
     * å¯ç”¨/ç¦ç”¨å…¨å±€æ£€æµ‹
     */
    public void setGlobalDetection(boolean enabled) {
        lockManager.setGlobalDetectionEnabled(enabled);
    }
}
```

### ç›‘æ§å’Œå‘Šè­¦

```java
@Component
public class DeadlockMonitor {
    
    @Autowired
    private LockManager lockManager;
    
    /**
     * å®šæœŸæ£€æŸ¥æ­»é”çŠ¶æ€
     */
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void monitorDeadlocks() {
        if (!lockManager.isDistributedDeadlockEnabled()) {
            return;
        }
        
        // è·å–å…¨å±€çŠ¶æ€
        Map<String, Object> status = lockManager.getDistributedDeadlockStatus();
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”
        List<Set<String>> cycles = lockManager.detectGlobalDeadlocks();
        if (!cycles.isEmpty()) {
            log.warn("æ£€æµ‹åˆ°æ­»é”ç¯: {}", cycles);
            // å‘é€å‘Šè­¦é€šçŸ¥
            sendDeadlockAlert(cycles);
        }
        
        // æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
        @SuppressWarnings("unchecked")
        Map<String, Object> nodes = (Map<String, Object>) status.get("globalNodes");
        if (nodes != null) {
            checkNodeHealth(nodes);
        }
    }
    
    private void sendDeadlockAlert(List<Set<String>> cycles) {
        // å®ç°å‘Šè­¦é€»è¾‘
        log.error("æ£€æµ‹åˆ° {} ä¸ªæ­»é”ç¯ï¼Œéœ€è¦äººå·¥å¹²é¢„", cycles.size());
    }
    
    private void checkNodeHealth(Map<String, Object> nodes) {
        long currentTime = System.currentTimeMillis();
        for (Map.Entry<String, Object> entry : nodes.entrySet()) {
            String nodeId = entry.getKey();
            long lastHeartbeat = Long.parseLong(entry.getValue().toString());
            
            if (currentTime - lastHeartbeat > 60000) { // è¶…è¿‡1åˆ†é’Ÿæœªå¿ƒè·³
                log.warn("èŠ‚ç‚¹ {} å¿ƒè·³å¼‚å¸¸ï¼Œæœ€åå¿ƒè·³æ—¶é—´: {}", nodeId, new Date(lastHeartbeat));
            }
        }
    }
}
```

### è‡ªå®šä¹‰æ­»é”å¤„ç†

```java
@Component
public class CustomDeadlockHandler {
    
    @Autowired
    private LockManager lockManager;
    
    /**
     * è‡ªå®šä¹‰æ­»é”å¤„ç†é€»è¾‘
     */
    public void handleDeadlock(Set<String> deadlockCycle) {
        log.info("å¤„ç†æ­»é”ç¯: {}", deadlockCycle);
        
        // 1. è®°å½•æ­»é”ä¿¡æ¯
        recordDeadlockInfo(deadlockCycle);
        
        // 2. é€‰æ‹©ç‰ºç‰²çº¿ç¨‹ï¼ˆè‡ªå®šä¹‰ç­–ç•¥ï¼‰
        String victimThread = selectVictimThread(deadlockCycle);
        
        // 3. é€šçŸ¥ç›¸å…³æœåŠ¡
        notifyAffectedServices(deadlockCycle);
        
        // 4. æ‰§è¡Œæ¢å¤æ“ä½œ
        executeRecovery(victimThread);
    }
    
    private String selectVictimThread(Set<String> deadlockCycle) {
        // è‡ªå®šä¹‰ç‰ºç‰²çº¿ç¨‹é€‰æ‹©ç­–ç•¥
        // ä¾‹å¦‚ï¼šé€‰æ‹©æŒæœ‰é”æœ€å°‘çš„çº¿ç¨‹
        return deadlockCycle.iterator().next();
    }
    
    private void recordDeadlockInfo(Set<String> deadlockCycle) {
        // è®°å½•æ­»é”ä¿¡æ¯åˆ°æ•°æ®åº“æˆ–æ—¥å¿—
        log.error("æ­»é”è¯¦æƒ…: æ¶‰åŠçº¿ç¨‹ {}, æ—¶é—´: {}", deadlockCycle, new Date());
    }
    
    private void notifyAffectedServices(Set<String> deadlockCycle) {
        // é€šçŸ¥ç›¸å…³æœåŠ¡å¤„ç†æ­»é”
        // å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ã€HTTPè°ƒç”¨ç­‰æ–¹å¼
    }
    
    private void executeRecovery(String victimThread) {
        // æ‰§è¡Œæ¢å¤æ“ä½œ
        // ä¾‹å¦‚ï¼šå›æ»šäº‹åŠ¡ã€é‡Šæ”¾èµ„æºç­‰
    }
}
```

## ç®—æ³•åŸç†

### DFSç¯æ£€æµ‹ç®—æ³•

```java
/**
 * ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æ£€æµ‹æ­»é”ç¯
 */
private boolean hasGlobalCycle(String threadId, Set<String> visited, 
                              Set<String> recursionStack, Set<String> cycle,
                              Map<String, Set<String>> globalThreadWaits, 
                              Map<String, String> globalLockHolders) {
    
    // å¦‚æœå½“å‰çº¿ç¨‹åœ¨é€’å½’æ ˆä¸­ï¼Œè¯´æ˜å­˜åœ¨ç¯
    if (recursionStack.contains(threadId)) {
        cycle.add(threadId);
        return true;
    }
    
    // å¦‚æœå·²ç»è®¿é—®è¿‡ï¼Œç›´æ¥è¿”å›
    if (visited.contains(threadId)) {
        return false;
    }
    
    // æ ‡è®°ä¸ºå·²è®¿é—®å’Œé€’å½’æ ˆä¸­
    visited.add(threadId);
    recursionStack.add(threadId);
    cycle.add(threadId);
    
    // æ£€æŸ¥å½“å‰çº¿ç¨‹ç­‰å¾…çš„é”
    Set<String> waits = globalThreadWaits.get(threadId);
    if (waits != null) {
        for (String lockKey : waits) {
            String holder = globalLockHolders.get(lockKey);
            if (holder != null && !holder.equals(threadId)) {
                // é€’å½’æ£€æŸ¥é”æŒæœ‰è€…
                if (hasGlobalCycle(holder, visited, recursionStack, cycle, 
                                 globalThreadWaits, globalLockHolders)) {
                    return true;
                }
            }
        }
    }
    
    // ä»é€’å½’æ ˆä¸­ç§»é™¤
    recursionStack.remove(threadId);
    cycle.remove(threadId);
    return false;
}
```

### ç‰ºç‰²çº¿ç¨‹é€‰æ‹©ç­–ç•¥

```java
/**
 * ç‰ºç‰²çº¿ç¨‹é€‰æ‹©ç­–ç•¥
 */
private String selectGlobalVictimThread(Set<String> cycle) {
    // ç­–ç•¥1: é€‰æ‹©èŠ‚ç‚¹IDæœ€å°çš„çº¿ç¨‹
    return cycle.stream()
               .min(Comparator.naturalOrder())
               .orElse(null);
    
    // ç­–ç•¥2: é€‰æ‹©æŒæœ‰é”æœ€å°‘çš„çº¿ç¨‹
    // return cycle.stream()
    //            .min(Comparator.comparing(this::getLockCount))
    //            .orElse(null);
    
    // ç­–ç•¥3: é€‰æ‹©ä¼˜å…ˆçº§æœ€ä½çš„çº¿ç¨‹
    // return cycle.stream()
    //            .min(Comparator.comparing(this::getThreadPriority))
    //            .orElse(null);
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. åŒæ­¥ä¼˜åŒ–

- **å¢é‡åŒæ­¥**: åªåŒæ­¥å˜åŒ–çš„çŠ¶æ€ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
- **æ‰¹é‡æ“ä½œ**: ä½¿ç”¨Redisç®¡é“æ‰¹é‡æ›´æ–°çŠ¶æ€
- **å‹ç¼©ä¼ è¾“**: å¯¹çŠ¶æ€æ•°æ®è¿›è¡Œå‹ç¼©ä¼ è¾“

### 2. æ£€æµ‹ä¼˜åŒ–

- **åˆ†å±‚æ£€æµ‹**: å…ˆè¿›è¡Œæœ¬åœ°æ£€æµ‹ï¼Œå†è¿›è¡Œå…¨å±€æ£€æµ‹
- **å¼‚æ­¥æ£€æµ‹**: ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡è¿›è¡Œæ­»é”æ£€æµ‹
- **ç¼“å­˜ç»“æœ**: ç¼“å­˜æ£€æµ‹ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—

### 3. å­˜å‚¨ä¼˜åŒ–

- **æ•°æ®è¿‡æœŸ**: è®¾ç½®åˆç†çš„æ•°æ®è¿‡æœŸæ—¶é—´
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºRedisé”®å»ºç«‹åˆé€‚çš„ç´¢å¼•
- **åˆ†ç‰‡å­˜å‚¨**: å¯¹å¤§é‡æ•°æ®è¿›è¡Œåˆ†ç‰‡å­˜å‚¨

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åŒæ­¥å¤±è´¥**
   - æ£€æŸ¥Redisè¿æ¥æ˜¯å¦æ­£å¸¸
   - éªŒè¯ç½‘ç»œå»¶è¿Ÿå’Œè¶…æ—¶è®¾ç½®
   - æ£€æŸ¥Rediså†…å­˜ä½¿ç”¨æƒ…å†µ

2. **æ£€æµ‹ä¸å‡†ç¡®**
   - è°ƒæ•´åŒæ­¥é—´éš”å‚æ•°
   - æ£€æŸ¥èŠ‚ç‚¹æ—¶é’ŸåŒæ­¥
   - éªŒè¯æ£€æµ‹ç®—æ³•å®ç°

3. **æ€§èƒ½é—®é¢˜**
   - ä¼˜åŒ–åŒæ­¥é¢‘ç‡
   - å‡å°‘æ£€æµ‹èŒƒå›´
   - ä½¿ç”¨å¼‚æ­¥å¤„ç†

### è°ƒè¯•æŠ€å·§

```yaml
# å¯ç”¨è°ƒè¯•æ—¥å¿—
logging:
  level:
    com.indigo.cache.extension.lock.DistributedDeadlockDetector: DEBUG

# å¯ç”¨è¯¦ç»†çŠ¶æ€è¾“å‡º
synapse:
  cache:
    lock:
      deadlock:
        distributed:
          debug: true
```

## æœ€ä½³å®è·µ

### 1. é…ç½®å»ºè®®

- **åŒæ­¥é—´éš”**: æ ¹æ®ç½‘ç»œå»¶è¿Ÿè°ƒæ•´ï¼Œä¸€èˆ¬5-10ç§’
- **æ£€æµ‹é—´éš”**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼Œä¸€èˆ¬10-30ç§’
- **èŠ‚ç‚¹è¶…æ—¶**: è®¾ç½®ä¸ºå¿ƒè·³é—´éš”çš„3-5å€

### 2. ç›‘æ§å»ºè®®

- **å®šæœŸæ£€æŸ¥**: è®¾ç½®å®šæœŸæ£€æŸ¥ä»»åŠ¡ç›‘æ§æ­»é”çŠ¶æ€
- **å‘Šè­¦æœºåˆ¶**: å»ºç«‹æ­»é”å‘Šè­¦æœºåˆ¶
- **æ€§èƒ½ç›‘æ§**: ç›‘æ§æ£€æµ‹æ€§èƒ½å½±å“

### 3. è¿ç»´å»ºè®®

- **èŠ‚ç‚¹ç®¡ç†**: åŠæ—¶æ¸…ç†å¤±æ•ˆèŠ‚ç‚¹
- **çŠ¶æ€æ¸…ç†**: å®šæœŸæ¸…ç†è¿‡æœŸçŠ¶æ€æ•°æ®
- **æ—¥å¿—åˆ†æ**: å®šæœŸåˆ†ææ­»é”æ—¥å¿—

## ç‰ˆæœ¬å†å²

- **v1.0.0**: åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€åˆ†å¸ƒå¼æ­»é”æ£€æµ‹
- **v1.1.0**: ä¼˜åŒ–æ£€æµ‹ç®—æ³•ï¼Œæé«˜æ€§èƒ½
- **v1.2.0**: å¢åŠ è‡ªå®šä¹‰å¤„ç†ç­–ç•¥
- **v1.3.0**: å®Œå–„ç›‘æ§å’Œå‘Šè­¦åŠŸèƒ½
