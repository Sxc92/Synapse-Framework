# Synapse Cache æ¨¡å—

## ğŸ“‹ æ¦‚è¿°

Synapse Cache æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç¼“å­˜å’Œåˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†å®Œæ•´çš„ç¼“å­˜æ³¨è§£æ”¯æŒã€å¤šçº§ç¼“å­˜ç­–ç•¥å’Œåˆ†å¸ƒå¼é”åŠŸèƒ½ã€‚è¯¥æ¨¡å—é‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–å’Œè‡ªåŠ¨é‡Šæ”¾æœºåˆ¶ï¼Œç¡®ä¿èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. ç¼“å­˜æ³¨è§£ç³»ç»Ÿ
- **@Cacheable**: æ–¹æ³•ç»“æœç¼“å­˜
- **@CachePut**: ç¼“å­˜æ•°æ®æ›´æ–°
- **@CacheEvict**: ç¼“å­˜æ•°æ®åˆ é™¤
- **@Caching**: ç»„åˆç¼“å­˜æ“ä½œ

### 2. åˆ†å¸ƒå¼é”æœåŠ¡
- **å»¶è¿Ÿåˆå§‹åŒ–**: æŒ‰éœ€åˆ†é…èµ„æº
- **è‡ªåŠ¨é‡Šæ”¾**: æ™ºèƒ½èµ„æºç®¡ç†
- **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½æŒ‡æ ‡
- **æ­»é”æ£€æµ‹**: è‡ªåŠ¨æ­»é”è¯†åˆ«

### 3. å¤šçº§ç¼“å­˜ç­–ç•¥
- **LOCAL_ONLY**: ä»…æœ¬åœ°ç¼“å­˜
- **REDIS_ONLY**: ä»…Redisç¼“å­˜
- **LOCAL_AND_REDIS**: æœ¬åœ°+Redisç¼“å­˜
- **REDIS_SYNC_TO_LOCAL**: RedisåŒæ­¥åˆ°æœ¬åœ°

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### ä½¿ç”¨æŒ‡å—
- [ç¼“å­˜æ³¨è§£ä½¿ç”¨æŒ‡å—](CACHE_ANNOTATIONS_USAGE.md) - è¯¦ç»†çš„ç¼“å­˜æ³¨è§£ä½¿ç”¨æ–¹æ³•
- [åˆ†å¸ƒå¼é”ä¼˜åŒ–æ–‡æ¡£](DISTRIBUTED_LOCK_OPTIMIZATION.md) - åˆ†å¸ƒå¼é”åŠŸèƒ½è¯¦è§£

### æŠ€æœ¯æ–‡æ¡£
- [ä¼˜åŒ–å·¥ä½œæ€»ç»“](OPTIMIZATION_SUMMARY.md) - æ¨¡å—ä¼˜åŒ–å†ç¨‹å’Œæˆæœæ€»ç»“

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.indigo</groupId>
    <artifactId>synapse-cache</artifactId>
    <version>${synapse.version}</version>
</dependency>
```

### 2. åŸºç¡€é…ç½®

```yaml
synapse:
  cache:
    lock:
      auto-release:
        enabled: true
        threshold: 300000      # 5åˆ†é’Ÿ
        check-interval: 60000  # 1åˆ†é’Ÿ
      monitor:
        enabled: true
        granularity: 1000      # 1ç§’
```

### 3. ä½¿ç”¨ç¼“å­˜æ³¨è§£

```java
@Service
public class UserService {
    
    @Cacheable(key = "user:#id", expireSeconds = 3600)
    public User getUserById(Long id) {
        return userRepository.findById(id);
    }
}
```

### 4. ä½¿ç”¨åˆ†å¸ƒå¼é”

```java
@Autowired
private LockManager lockManager;

String lockValue = lockManager.tryLock("resource", "key", 10);
try {
    // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
} finally {
    lockManager.releaseLock("resource", "key", lockValue);
}
```

## ğŸ¯ ä¸»è¦ç‰¹æ€§

### æ€§èƒ½ä¼˜åŒ–
- **å»¶è¿Ÿåˆå§‹åŒ–**: å¯åŠ¨æ—¶ä¸å ç”¨èµ„æº
- **è‡ªåŠ¨é‡Šæ”¾**: ç©ºé—²æ—¶è‡ªåŠ¨å›æ”¶èµ„æº
- **æ™ºèƒ½ç¼“å­˜**: å¤šçº§ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

### è¿ç»´å‹å¥½
- **é…ç½®çµæ´»**: æ”¯æŒå¤šç§é…ç½®é€‰é¡¹
- **ç›‘æ§å®Œå–„**: è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡
- **æ—¥å¿—ä¼˜åŒ–**: åˆç†çš„æ—¥å¿—çº§åˆ«

### å¼€å‘ä¾¿åˆ©
- **æ³¨è§£é©±åŠ¨**: ç®€å•çš„æ³¨è§£ä½¿ç”¨æ–¹å¼
- **APIç®€æ´**: æ¸…æ™°çš„æ¥å£è®¾è®¡
- **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

## ğŸ” é…ç½®é€‰é¡¹

### åˆ†å¸ƒå¼é”é…ç½®
```yaml
synapse:
  cache:
    lock:
      auto-release:
        enabled: true          # å¯ç”¨è‡ªåŠ¨é‡Šæ”¾
        threshold: 300000      # é‡Šæ”¾é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰
        check-interval: 60000  # æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰
      monitor:
        enabled: true          # å¯ç”¨ç›‘æ§
        granularity: 1000      # ç›‘æ§ç²’åº¦ï¼ˆæ¯«ç§’ï¼‰
        deadlock-detection: true  # æ­»é”æ£€æµ‹
```

### ç¼“å­˜ç­–ç•¥é…ç½®
```yaml
synapse:
  cache:
    strategy:
      default: LOCAL_AND_REDIS  # é»˜è®¤ç¼“å­˜ç­–ç•¥
      local:
        max-size: 10000         # æœ¬åœ°ç¼“å­˜æœ€å¤§å¤§å°
        expire-seconds: 1800    # æœ¬åœ°ç¼“å­˜è¿‡æœŸæ—¶é—´
      redis:
        expire-seconds: 3600    # Redisç¼“å­˜è¿‡æœŸæ—¶é—´
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•ç”¨ä¾‹éªŒè¯åŠŸèƒ½ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•
mvn test -Dtest=CacheAnnotationTest
mvn test -Dtest=LockManagerTest
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç¼“å­˜æ€§èƒ½
- **æœ¬åœ°ç¼“å­˜**: çº³ç§’çº§å“åº”
- **Redisç¼“å­˜**: æ¯«ç§’çº§å“åº”
- **å‘½ä¸­ç‡**: æ”¯æŒå®æ—¶ç›‘æ§

### åˆ†å¸ƒå¼é”æ€§èƒ½
- **è·å–é”**: å¹³å‡ < 10ms
- **é‡Šæ”¾é”**: å¹³å‡ < 5ms
- **æ­»é”æ£€æµ‹**: 5ç§’å†…è¯†åˆ«

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. ç¼“å­˜ä½¿ç”¨
- åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
- é¿å…ç¼“å­˜é›ªå´©
- æ³¨æ„ç¼“å­˜ä¸€è‡´æ€§

### 2. åˆ†å¸ƒå¼é”
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- ç¡®ä¿é”çš„é‡Šæ”¾
- é¿å…æ­»é”æƒ…å†µ

### 3. é…ç½®å»ºè®®
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¾ƒé•¿çš„é˜ˆå€¼
- å¼€å‘ç¯å¢ƒä½¿ç”¨è¾ƒçŸ­çš„æ£€æŸ¥é—´éš”
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ç¼“å­˜ç­–ç•¥

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿› Synapse Cache æ¨¡å—ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache License 2.0](LICENSE) è®¸å¯è¯ã€‚ 